#!/usr/bin/env python3
"""Check pentest status via web API"""

import requests
import json
import sys

API_BASE = "https://pentest.red/api"

def check_api():
    """Check API endpoints"""
    print("=" * 60)
    print("CHECKING PENTEST API")
    print("=" * 60)
    
    # Check health
    print("\n1. Health check...")
    try:
        r = requests.get(f"{API_BASE}/health", timeout=10)
        print(f"   Status: {r.status_code}")
        print(f"   Response: {r.text[:200]}")
    except Exception as e:
        print(f"   [ERROR] {e}")
    
    # Check pentests
    print("\n2. Getting pentests list...")
    try:
        r = requests.get(f"{API_BASE}/pentests", timeout=10)
        print(f"   Status: {r.status_code}")
        if r.status_code == 200:
            pentests = r.json()
            print(f"   Found {len(pentests)} pentests")
            if pentests:
                latest = pentests[0]
                print(f"   Latest: {latest.get('name', 'N/A')}")
                print(f"   Status: {latest.get('status', 'N/A')}")
                print(f"   Target: {latest.get('targetUrl', 'N/A')}")
        else:
            print(f"   Response: {r.text[:200]}")
    except Exception as e:
        print(f"   [ERROR] {e}")
    
    # Check services
    print("\n3. Getting services list...")
    try:
        r = requests.get(f"{API_BASE}/services", timeout=10)
        print(f"   Status: {r.status_code}")
        if r.status_code == 200:
            services = r.json()
            print(f"   Found {len(services)} services")
        else:
            print(f"   Response: {r.text[:200]}")
    except Exception as e:
        print(f"   [ERROR] {e}")
    
    print("\n" + "=" * 60)

if __name__ == "__main__":
    check_api()

