# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π** - –¥–µ–ø–ª–æ–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `prod`
‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ GitHub —Å–µ—Ä–≤–µ—Ä–∞—Ö
‚úÖ **–í–∏–¥–∏–º—ã–π –≤—ã–≤–æ–¥** - –≤—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ GitHub Actions
‚úÖ **–ù–∞–¥–µ–∂–Ω—ã–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π** - —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ GitHub Secrets

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –° –ø–∞—Ä–æ–ª–µ–º (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
   - https://github.com/Hexttr/xaker/settings/secrets/actions

2. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:**
   - `SERVER_HOST` = `5.129.235.52`
   - `SERVER_USER` = `root`
   - `SERVER_PASSWORD` = `cY7^kCCA_6uQ5S`
   - `SERVER_PORT` = `22`

3. **–§–∞–π–ª `.github/workflows/deploy.yml` —É–∂–µ —Å–æ–∑–¥–∞–Ω** - –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—à—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
   - –°–¥–µ–ª–∞–π—Ç–µ –ª—é–±–æ–π –∫–æ–º–º–∏—Ç –≤ –≤–µ—Ç–∫—É `prod`
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions: https://github.com/Hexttr/xaker/actions
   - –£–≤–∏–¥–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π!

### –í–∞—Ä–∏–∞–Ω—Ç 2: –° SSH –∫–ª—é—á–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

1. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/github_actions
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ authorized_keys:**
   ```bash
   cat ~/.ssh/github_actions.pub >> ~/.ssh/authorized_keys
   ```

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:**
   ```bash
   cat ~/.ssh/github_actions
   ```

4. **–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:**
   - `SERVER_HOST` = `5.129.235.52`
   - `SERVER_USER` = `root`
   - `SERVER_SSH_KEY` = `<–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á>`
   - `SERVER_PORT` = `22`

5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `.github/workflows/deploy-ssh-key.yml`**

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü—Ä–æ—Å—Ç–æ –ø—É—à–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ç–∫—É `prod`:
```bash
git push origin prod
```

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ (`git pull`)
3. –°–æ–±–µ—Ä–µ—Ç backend (`npm run build`)
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`pm2 restart`)

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub UI:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow "Deploy to Production"
3. –ù–∞–∂–º–∏—Ç–µ "Run workflow"

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
- https://github.com/Hexttr/xaker/actions

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –¥–µ–ø–ª–æ–∏ (–∑–µ–ª–µ–Ω—ã–π)
- ‚ùå –û—à–∏–±–∫–∏ (–∫—Ä–∞—Å–Ω—ã–π)
- üìã –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è GitHub Actions
- ‚úÖ –ù–µ –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü—Ä–æ—Å—Ç–æ–π API endpoint –¥–ª—è –¥–µ–ø–ª–æ—è

–ï—Å–ª–∏ GitHub Actions –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π API endpoint –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```typescript
// backend/src/routes/deploy.routes.ts
router.post('/deploy', async (req, res) => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
  if (req.headers['x-deploy-token'] !== process.env.DEPLOY_TOKEN) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è
  const { exec } = require('child_process');
  exec('cd /root/xaker && git pull && cd backend && npm run build && pm2 restart xaker-backend', 
    (error, stdout, stderr) => {
      res.json({ stdout, stderr, error: error?.message });
    });
});
```

–¢–æ–≥–¥–∞ –¥–µ–ø–ª–æ–π –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç—ã–º HTTP –∑–∞–ø—Ä–æ—Å–æ–º:
```bash
curl -X POST https://pentest.red/api/deploy \
  -H "X-Deploy-Token: your-secret-token"
```

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Actions - —ç—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –∏ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–±!

