#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Show detailed pentest information"""

import requests
import json
import sys
import os
from datetime import datetime

# Fix encoding for Windows
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')

API_BASE = "https://pentest.red/api"
PENTEST_ID = "cc8d4a16-a0bb-4570-b7b3-66fd8cb607c3"

def main():
    print("=" * 80)
    print("PENTEST DETAILED LOGS")
    print("=" * 80)
    
    # Get pentest info
    pentest = requests.get(f"{API_BASE}/pentests/{PENTEST_ID}").json()
    print(f"\nPentest: {pentest.get('name', 'N/A')}")
    print(f"Status: {pentest.get('status', 'N/A')}")
    print(f"Target: {pentest.get('targetUrl', 'N/A')}")
    print(f"Created: {pentest.get('createdAt', 'N/A')}")
    
    # Get logs
    logs = requests.get(f"{API_BASE}/pentests/{PENTEST_ID}/logs").json()
    print(f"\nTotal logs: {len(logs)}")
    
    # Show all logs grouped by type
    print("\n" + "=" * 80)
    print("ALL LOGS:")
    print("=" * 80)
    
    for i, log in enumerate(logs, 1):
        level = log.get('level', 'info').upper()
        timestamp = log.get('timestamp', '')
        message = log.get('message', '')
        
        # Format timestamp
        try:
            dt = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))
            ts_str = dt.strftime('%H:%M:%S')
        except:
            ts_str = timestamp
        
        # Color code by level
        if level == 'ERROR':
            prefix = "❌"
        elif level == 'SUCCESS':
            prefix = "✅"
        elif level == 'WARN':
            prefix = "⚠️"
        else:
            prefix = "ℹ️"
        
        print(f"{prefix} [{ts_str}] {message}")
        
        # Show every 10th log summary
        if i % 10 == 0:
            print(f"   ... ({i}/{len(logs)} logs shown) ...")

if __name__ == "__main__":
    main()

