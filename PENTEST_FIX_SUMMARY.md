# ✅ Исправления для пентестера

## Проблема
Пентест не запускается из-за неправильной проверки доступности Shannon.

## Внесенные исправления

### 1. Исправлена проверка доступности Shannon ✅
- **Было**: Проверялся только `SHANNON_DIST_PATH`, но использовался `SHANNON_MAIN_PATH`
- **Стало**: Проверяются все возможные пути:
  - `dist/temporal/client.js` (основной)
  - `dist/cli/ui.js` (альтернативный)  
  - `dist/shannon.js` (старый путь)

### 2. Добавлена детальная диагностика ✅
При отсутствии Shannon в логах теперь выводится:
- Все проверяемые пути
- Текущая рабочая директория (`process.cwd()`)
- Существование директории Shannon
- Какой путь найден/не найден

### 3. Улучшен выбор точки входа ✅
Система автоматически выбирает доступную точку входа из всех вариантов.

### 4. Добавлена настройка пути через переменную окружения ✅
Теперь можно указать путь к Shannon через `SHANNON_PATH` в `.env`:
```bash
SHANNON_PATH=/root/shannon
```

## Файлы изменены

1. `backend/src/services/shannon.service.ts` - основные исправления
2. `backend/env.example` - добавлена документация SHANNON_PATH
3. `backend/env.production.example` - добавлена документация SHANNON_PATH

## Что нужно сделать на сервере

### Вариант 1: Проверить текущую установку
```bash
# Проверить где находится Shannon
ls -la /root/shannon/dist/temporal/client.js

# Если найден, проверить путь в .env
cd /root/xaker/backend
grep SHANNON_PATH .env || echo "SHANNON_PATH not set"
```

### Вариант 2: Настроить путь в .env (если Shannon в другом месте)
```bash
cd /root/xaker/backend
echo "SHANNON_PATH=/root/shannon" >> .env
# или если Shannon в другом месте:
# echo "SHANNON_PATH=/opt/shannon" >> .env
```

### Вариант 3: Перезапустить backend
```bash
pm2 restart xaker-backend
# или
cd /root/xaker/backend && npm run start
```

## Ожидаемый результат

После применения исправлений:

1. **В логах при запуске пентеста** появятся детальные сообщения:
   ```
   [Shannon] Checking paths...
   [Shannon] SHANNON_MAIN_PATH: /root/shannon/dist/temporal/client.js
   [Shannon] Found: true/false
   ```

2. **Если Shannon найден** - пентест запустится реально
3. **Если Shannon не найден** - будет понятно почему (детальные логи)

## Диагностика проблем

Если пентест все еще не работает, проверьте логи backend:
```bash
pm2 logs xaker-backend --lines 50
```

Ищите сообщения с `[Shannon]` - там будет детальная информация о том, что проверяется и что найдено.

## Следующие шаги

1. ✅ Код исправлен
2. ⏳ Нужно задеплоить на сервер
3. ⏳ Проверить работу пентестера

---

**Статус**: ✅ Готово к деплою

