# Структура промптов для генерации отчетов

## Обзор

В проекте используется **3 основных промпта** для генерации PDF отчетов:

1. **Основной отчет** (`generateAttackChainWithMiroMind`) - полный отчет со всеми разделами
2. **Детальный анализ** (`generateDetailedAnalysisWithMiroMind`) - дополнительный раздел с глубоким анализом
3. **Цепочка взлома** (`generateAttackChainSectionWithMiroMind`) - отдельный раздел с пошаговой цепочкой

---

## ПРОМПТ 1: Основной отчет (generateAttackChainWithMiroMind)

### Назначение
Генерирует полный отчет по результатам пентеста со всеми 7 обязательными разделами.

### Параметры
- **Модель**: Ollama (llama3.1:8b) через MiroMind
- **max_tokens**: Без ограничений (модель сама определяет размер ответа)
- **Размер контента**: до 200000 символов из файлов

### Структура промпта

#### 1. ЯЗЫКОВЫЕ ТРЕБОВАНИЯ
- ✅ Только русский язык
- ✅ Никаких английских текстов
- ✅ Только русские заголовки
- ✅ Запрет на "Executive Summary" → использовать "Краткое резюме"
- ✅ Запрет на "Critical Vulnerabilities" → использовать "Критические уязвимости"

#### 2. ТРЕБОВАНИЯ К СОДЕРЖАНИЮ
- ✅ Полный и подробный отчет без ограничений по размеру
- ✅ **КРИТИЧЕСКИ ВАЖНО**: Файлы Shannon предоставлены ТОЛЬКО для анализа - НЕ копировать их содержимое!
- ✅ Провести глубокий анализ файлов Shannon и создать СВОЙ СОБСТВЕННЫЙ отчет на русском языке
- ✅ НЕ копировать тексты, команды, коды, логи или любые другие фрагменты из файлов Shannon
- ✅ НЕ переписывать содержимое файлов - АНАЛИЗИРОВАТЬ и ОПИСЫВАТЬ СВОИМИ СЛОВАМИ
- ✅ Отчет должен быть РЕЗУЛЬТАТОМ АНАЛИЗА модели, а не копией файлов
- ✅ Использовать информацию из файлов для понимания ситуации, но формулировать выводы САМОСТОЯТЕЛЬНО
- ✅ Описывать найденные уязвимости, их влияние и рекомендации СВОИМИ СЛОВАМИ на русском языке
- ✅ Включать критические, высокие и средние уязвимости (низкие можно пропустить)
- ✅ Не дублировать информацию между разделами
- ✅ Включать все важные детали и технические подробности

#### 3. СТРУКТУРА ОТЧЕТА (7 обязательных разделов)

##### Раздел 1: Краткое резюме
- Краткое описание проведенного пентеста
- Общая оценка уровня безопасности сервиса
- Ключевые выводы и рекомендации
- Критичность найденных уязвимостей (общая статистика)

##### Раздел 2: Методология тестирования
- Описание использованной методологии
- Объем и глубина тестирования
- Инструменты и технологии
- Временные рамки проведения пентеста

##### Раздел 3: ПОДРОБНАЯ ЦЕПОЧКА ВЗЛОМА
- Начальная точка атаки (reconnaissance, сканирование)
- Каждый шаг атаки подробно (как злоумышленник может использовать уязвимости)
- Последовательность: обнаружение → эксплуатация → эскалация привилегий → достижение цели
- Для каждого шага: что делает злоумышленник, какие инструменты использует, какой результат получает
- Минимум 5-7 шагов в цепочке взлома
- Каждый шаг - минимум 3-5 предложений

##### Раздел 4: Детальный анализ найденных уязвимостей
Для КАЖДОЙ критической/высокой/средней уязвимости:
- **Название уязвимости** (можно указать английское название в скобках)
- **Критичность** (КРИТИЧЕСКАЯ/ВЫСОКАЯ/СРЕДНЯЯ или CRITICAL/HIGH/MEDIUM)
- **Расположение** (URL или эндпоинт)
- **Подробное описание** (3-5 предложений - что не так, почему это проблема, как это можно эксплуатировать)
- **Бизнес-влияние** (2-3 предложения - какой ущерб может быть нанесен)
- **Рекомендации** (3-5 предложений - как исправить, с техническими деталями)

##### Раздел 5: Оценка рисков
- Общая оценка рисков для бизнеса
- Приоритизация уязвимостей по бизнес-критичности
- Потенциальный ущерб от эксплуатации уязвимостей
- Временные рамки для исправления критических уязвимостей

##### Раздел 6: Рекомендации и план действий
- Общие рекомендации по улучшению безопасности
- План действий по устранению уязвимостей (приоритизированный)
- Рекомендации по долгосрочному улучшению безопасности
- Best practices для предотвращения подобных уязвимостей

##### Раздел 7: Заключение
- Общие выводы по результатам пентеста
- Оценка текущего состояния безопасности
- Рекомендации по дальнейшему мониторингу

#### 4. ИСХОДНЫЕ ДАННЫЕ
- Файлы с результатами пентеста (до 200000 символов)
- Используются только для анализа, НЕ копируются в отчет

---

## ПРОМПТ 2: Детальный анализ (generateDetailedAnalysisWithMiroMind)

### Назначение
Генерирует дополнительный раздел "Детальные результаты анализа" с глубоким анализом всех уязвимостей.

### Параметры
- **Модель**: Ollama (llama3.1:8b) через MiroMind
- **max_tokens**: Без ограничений (модель сама определяет размер ответа)
- **Размер контента**: до 200000 символов из файлов

### Структура промпта

#### 1. ЯЗЫКОВЫЕ ТРЕБОВАНИЯ
- ✅ Только русский язык
- ✅ Все тексты на русском языке

#### 2. ТРЕБОВАНИЯ К СОДЕРЖАНИЮ
- ✅ Максимально длинный и подробный анализ без ограничений по размеру
- ✅ **КРИТИЧЕСКИ ВАЖНО**: Файлы Shannon предоставлены ТОЛЬКО для анализа - НЕ копировать их содержимое!
- ✅ Провести глубокий анализ файлов Shannon и создать СВОЙ СОБСТВЕННЫЙ анализ на русском языке
- ✅ НЕ копировать тексты, команды, коды, логи или любые другие фрагменты из файлов Shannon
- ✅ НЕ переписывать содержимое файлов - АНАЛИЗИРОВАТЬ и ОПИСЫВАТЬ СВОИМИ СЛОВАМИ
- ✅ Анализ должен быть РЕЗУЛЬТАТОМ АНАЛИЗА модели, а не копией файлов
- ✅ Использовать информацию из файлов для понимания ситуации, но формулировать выводы САМОСТОЯТЕЛЬНО
- ✅ Подробно описать ВСЕ ключевые моменты из анализа файлов
- ✅ Включить ВСЕ важное: все уязвимости, их влияние, рекомендации, технические детали
- ✅ Структурировать анализ по типам уязвимостей или по компонентам системы
- ✅ Расширять каждый раздел - добавлять детали, примеры, объяснения на основе анализа

#### 3. ФОРМАТИРОВАНИЕ
- ✅ Правильное форматирование Markdown
- ✅ Заголовки, списки, абзацы
- ✅ Каждый абзац - отдельная строка с пустой строкой между абзацами
- ✅ `###` для подразделов
- ✅ `**жирный**` для важного
- ✅ Списки для перечислений

#### 4. ИСХОДНЫЕ ДАННЫЕ
- Файлы для анализа (до 200000 символов)

---

## ПРОМПТ 3: Цепочка взлома (generateAttackChainSectionWithMiroMind)

### Назначение
Генерирует отдельный раздел "Цепочка взлома" с пошаговым описанием атакующих действий.

### Параметры
- **Модель**: Ollama (llama3.1:8b) через MiroMind
- **max_tokens**: Без ограничений (модель сама определяет размер ответа)
- **Размер контента**: до 100000 символов из файлов

### Структура промпта

#### 1. ЯЗЫКОВЫЕ ТРЕБОВАНИЯ
- ✅ Только русский язык
- ✅ Все тексты на русском языке

#### 2. ТРЕБОВАНИЯ К СОДЕРЖАНИЮ
- ✅ Подробная пошаговая цепочка взлома без ограничений по размеру
- ✅ **КРИТИЧЕСКИ ВАЖНО**: Файлы Shannon предоставлены ТОЛЬКО для анализа - НЕ копировать их содержимое!
- ✅ Провести глубокий анализ файлов Shannon и создать СВОЮ СОБСТВЕННУЮ цепочку взлома на русском языке
- ✅ НЕ копировать тексты, команды, коды, логи или любые другие фрагменты из файлов Shannon
- ✅ НЕ переписывать содержимое файлов - АНАЛИЗИРОВАТЬ и ОПИСЫВАТЬ СВОИМИ СЛОВАМИ
- ✅ Цепочка взлома должна быть РЕЗУЛЬТАТОМ АНАЛИЗА модели, а не копией файлов
- ✅ Использовать информацию из файлов для понимания ситуации, но формулировать цепочку САМОСТОЯТЕЛЬНО
- ✅ Показать как одна уязвимость может привести к другой (эскалация)
- ✅ Описать реальный сценарий эксплуатации найденных уязвимостей
- ✅ Не копировать фрагменты файлов - описывать своими словами

#### 3. СТРУКТУРА ЦЕПОЧКИ ВЗЛОМА
1. Начальная точка атаки (reconnaissance, сканирование)
2. Обнаружение первой уязвимости
3. Эксплуатация уязвимости
4. Эскалация привилегий (если возможно)
5. Достижение цели атаки
6. Дополнительные шаги (если есть)

#### 4. ДЛЯ КАЖДОГО ШАГА УКАЗАТЬ
- Что делает злоумышленник
- Какие инструменты использует
- Какой результат получает
- Как это связано со следующим шагом

#### 5. ФОРМАТИРОВАНИЕ
- ✅ Правильное форматирование Markdown
- ✅ Заголовки, списки, нумерация

#### 6. ИСХОДНЫЕ ДАННЫЕ
- Файлы для анализа (до 100000 символов)

---

## Сравнительная таблица промптов

| Параметр | Основной отчет | Детальный анализ | Цепочка взлома |
|----------|---------------|------------------|----------------|
| **max_tokens** | Без ограничений | Без ограничений | Без ограничений |
| **Размер контента** | 200000 символов | 200000 символов | 100000 символов |
| **Размер ответа** | Без ограничений | Без ограничений | Без ограничений |
| **Количество разделов** | 7 обязательных | 1 (структурированный) | 1 (пошаговый) |
| **Язык** | Только русский | Только русский | Только русский |
| **Уровень детализации** | Максимальный | Максимальный | Подробный |
| **Уязвимости** | Критические, высокие, средние | Все важные | Все, используемые в цепочке |
| **Анализ vs копирование** | Только анализ | Только анализ | Только анализ |

---

## Ключевые особенности всех промптов

### Общие требования
1. ✅ **Только русский язык** - жесткое требование для всех промптов
2. ✅ **Не копировать файлы** - анализировать и описывать своими словами
3. ✅ **Подробность** - минимум 3-5 предложений на каждый пункт
4. ✅ **Структурированность** - правильное форматирование Markdown
5. ✅ **Полнота** - включать все важные детали

### Различия
- **Основной отчет**: самый полный, содержит все 7 разделов
- **Детальный анализ**: фокус на глубоком анализе всех уязвимостей
- **Цепочка взлома**: фокус на пошаговой последовательности атак

---

## Проблемы и решения

### Проблема 1: Английский язык в ответах
**Причина**: Ollama (llama3.1:8b) иногда игнорирует требования о русском языке

**Решение**: 
- Усилить промпт повторением требований
- Добавить примеры правильного ответа
- Использовать более строгие инструкции

### Проблема 2: Короткие ответы
**Причина**: Модель экономит токены

**Решение**:
- Явно указать минимальный размер ответа
- Добавить инструкции "НЕ ЭКОНОМЬ НА СЛОВАХ"
- Увеличить max_tokens

### Проблема 3: Копирование файлов
**Причина**: Модель копирует фрагменты исходных файлов

**Решение**:
- Явный запрет на копирование
- Инструкция "описывать своими словами"
- Ограничение размера исходных файлов

---

## Рекомендации по улучшению

1. **Добавить примеры** правильного ответа в начале промпта
2. **Использовать system prompt** для Ollama (если поддерживается)
3. **Формат "Ты русскоязычный эксперт..."** вместо "Ты эксперт..."
4. **Добавить явный запрет** на английский язык в каждом разделе
5. **Увеличить повторения** требований о русском языке
6. **Добавить проверку** языка в коде после генерации

